{% load static%}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LiveStream Page</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="{% static '/livestream.css' %}">
</head>
<body>
  <div class="full-container">
    <div class="video-box" id="videoBox">
      <div id="loader" style="display:none;">
        <div class="spinner"></div>
          <p style="margin-top:10px;">Loading Camera...</p>
        </div>
      <img id="videoStream" style="max-width:100%; height:auto; display:none;">
      <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
      <div class="menu" id="menu">
        <a href="/home">Home</a>
        <a href="/about">About</a>
        <a href="/recording">Your Recording</a>
      </div>

      <div class="live-indicator" id="liveStatus">
        <span class="dot"></span> LIVE
        <span id="timer" style="margin-left: 8px; font-size: 14px; color: #FFF;"></span>
      </div>
      <div id="videoText">Video Stream Will Appear Here</div>
    </div>
    
    <div class="buttons">
      <button id="startBtn" class="start" onclick="startStream()">‚ñ∂ Start Stream</button>
      <button id="stopBtn" class="stop" onclick="stopStream()">‚èπ Stop Stream</button>
      <button class="save">‚¨á Save Video</button>
    </div>
  </div>

  <div class="description">
    <p>Seamlessly monitor real-time streams with instant start, secure recording, and history access. Experience smooth, reliable, and intelligent live video analysis ‚Äì all in one place.</p>
  </div>

  <footer>
    <p>¬© 2025 LiveVision | Designed with Django</p>
    <p>
      <a href="#">GitHub link</a> |
      <a href="#">LinkedIn link</a>
    </p>
  </footer>

  <script> 
    let timerInterval;
    function formatClock() {
      let now = new Date();
      let hours = now.getHours();
      let minutes = now.getMinutes();
      let ampm = hours >= 12 ? "PM" : "AM";
      hours = hours % 12;
      hours = hours ? hours : 12; // 0 ko 12 banane ke liye
      minutes = minutes < 10 ? "0" + minutes : minutes;
      return hours + ":" + minutes + " " + ampm;
    }

    function startStream() {
      fetch("/start_stream/");  // Django URL
      const video = document.getElementById("videoStream");
      const loader = document.getElementById("loader");
      const videoText = document.getElementById("videoText");

      // Show loader, hide video & text
      loader.style.display = "flex";
      video.style.display = "none";
      videoText.style.display = "none";

      // Jab video load hoga
      video.onload = () => {
        loader.style.display = "none";   // hide loader
        video.style.display = "block";   // show video
      };

      video.src = "/video_feed/";
      document.getElementById("liveStatus").style.display = "flex";
      document.getElementById("timer").innerText = formatClock();
      // üîπ Update clock every second
      timerInterval = setInterval(() => {
        document.getElementById("timer").innerText = formatClock();
      }, 1000);
      // üîπ Start button text & icon change
      document.getElementById("startBtn").innerHTML = "‚è∏ Streaming...";
      document.getElementById("startBtn").disabled = true; // optional: disable start button
    }

    function stopStream() {
      fetch("/stop_stream/"); // Django URL
      const video = document.getElementById("videoStream");
      const loader = document.getElementById("loader");
      const videoText = document.getElementById("videoText");
      // Reset to default state
      video.style.display = "none";         
      loader.style.display = "none";        
      videoText.style.display = "block";    
      videoText.innerText = "Video Stream Will Appear Here";
      video.src = "";
      document.getElementById("liveStatus").style.display = "none";
      clearInterval(timerInterval);
      // üîπ Start button ko wapas original bana do
      document.getElementById("startBtn").innerHTML = "‚ñ∂ Start Stream";
      document.getElementById("startBtn").disabled = false; // optional: enable again

    }
    function toggleMenu() {
      let menu = document.getElementById("menu");
      menu.style.display = (menu.style.display === "flex") ? "none" : "flex";
    }
    // Close menu if clicked outside
    window.onclick = function(event) {
      if (!event.target.matches('.menu-toggle')) {
        let menu = document.getElementById("menu");
        if (menu.style.display === "flex") {
          menu.style.display = "none";
        }
      }
    }
  </script>
</body>
</html>